<!-- imprimir-comprobante.html -->

<div class="contenedor-carga">
  <!-- ðŸ”„ LOADING STATE -->
  <div *ngIf="cargando" class="mensaje-carga">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #666"></i>
    <h3>Cargando comprobante...</h3>
  </div>

  <!-- âŒ ERROR STATE - Sin datos -->
  <div *ngIf="!cargando && !comprobante" class="mensaje-error">
    <i class="pi pi-exclamation-triangle" style="font-size: 3rem; color: #ef4444"></i>
    <h3>No se encontrÃ³ el comprobante</h3>
    <p>El comprobante solicitado no estÃ¡ disponible.</p>
    <p-button 
      label="Volver" 
      icon="pi pi-arrow-left" 
      severity="secondary" 
      (onClick)="volver()" 
    />
  </div>

  <!-- âœ… VISTA PREVIA DEL COMPROBANTE -->
  <div *ngIf="!cargando && comprobante && sede" class="vista-previa-comprobante">
    
    <!-- ðŸ¢ HEADER -->
    <div class="comprobante-header">
      <h2>{{ sede.nombre }}</h2>
      <p class="razon-social">{{ sede.razon_social }}</p>
      <p class="ruc">RUC: {{ sede.ruc }}</p>
    </div>

    <!-- ðŸŽ« TIPO DE COMPROBANTE -->
    <div class="comprobante-tipo">
      <p class="tipo-label">{{ tipoComprobante }}</p>
      <p class="serie-numero">{{ serieNumero }}</p>
    </div>

    <div class="divider"></div>

    <!-- ðŸ‘¤ DATOS DEL CLIENTE -->
    <div class="datos-cliente">
      <div class="dato-row">
        <span class="label">Cliente:</span>
        <span class="valor">{{ nombreCliente }}</span>
      </div>
      <div class="dato-row">
        <span class="label">Documento:</span>
        <span class="valor">{{ documentoCliente }}</span>
      </div>
      <div class="dato-row">
        <span class="label">Fecha:</span>
        <span class="valor">{{ fechaFormateada }}</span>
      </div>
    </div>

    <div class="divider"></div>

    <!-- ðŸ›’ PRODUCTOS -->
    <div class="productos-lista">
      <div class="productos-header">
        <span>Producto</span>
        <span>Cant.</span>
        <span>P.U.</span>
        <span>Total</span>
      </div>
      
      <ng-container *ngIf="comprobante.items?.length > 0; else noProductos">
        <div class="producto-item" *ngFor="let item of comprobante.items; trackBy: trackByIndex">
          <span class="producto-nombre" [title]="getNombreProducto(item)">
            {{ getNombreProducto(item) }}
          </span>
          <span class="cantidad">{{ item.cantidad }}</span>
          <span class="precio-unit">S/. {{ getPrecioUnitario(item) | number: '1.2-2' }}</span>
          <span class="subtotal">S/. {{ getSubtotalItem(item) | number: '1.2-2' }}</span>
        </div>
      </ng-container>

      <ng-template #noProductos>
        <div class="no-productos">
          <i class="pi pi-inbox"></i>
          <p>No hay productos en este comprobante</p>
        </div>
      </ng-template>
    </div>

    <div class="divider"></div>

    <!-- ðŸ’° TOTALES -->
    <div class="totales-section">
      <div class="total-row">
        <span class="label">Subtotal:</span>
        <span class="valor">S/. {{ comprobante.subtotal | number: '1.2-2' }}</span>
      </div>
      
      <div class="total-row" *ngIf="comprobante.igv > 0">
        <span class="label">IGV (18%):</span>
        <span class="valor">S/. {{ comprobante.igv | number: '1.2-2' }}</span>
      </div>
      
      <div class="total-row total-final">
        <span class="label">TOTAL:</span>
        <span class="valor">S/. {{ comprobante.total | number: '1.2-2' }}</span>
      </div>
      
      <div class="forma-pago">
        <span class="label">Forma de Pago:</span>
        <span class="valor">{{ formaPago }}</span>
      </div>
    </div>

    <!-- ðŸŽ‰ FOOTER -->
    <div class="comprobante-footer">
      <p>Â¡Gracias por su compra!</p>
      <p class="small">Conserve su comprobante</p>
    </div>
  </div>

  <!-- ðŸŽ›ï¸ BOTONES DE CONTROL -->
  <div *ngIf="!cargando && comprobante && sede" class="botones-control">
    <p-button 
      label="Ver / Imprimir" 
      icon="pi pi-print" 
      severity="info" 
      (onClick)="generarPDF()"
      [disabled]="!comprobante || !sede"
    />

    <p-button 
      label="Descargar PDF" 
      icon="pi pi-download" 
      (onClick)="descargarPDF()"
      [disabled]="!comprobante || !sede"
    />

    <p-button 
      label="Volver" 
      icon="pi pi-arrow-left" 
      severity="secondary" 
      (onClick)="volver()" 
    />
  </div>
</div>
