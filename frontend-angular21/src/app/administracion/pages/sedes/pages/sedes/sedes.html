<div class="sedes-page">
  <p-card styleClass="sedes-header-card">
    <div class="flex align-items-center justify-content-between flex-wrap gap-3">
      <div class="flex align-items-center gap-3">
        <span class="sedes-title-icon">
          <i class="pi pi-list"></i>
        </span>
        <div>
          <p class="sedes-kicker">ADMINISTRADOR - ADMINISTRACION - SEDES</p>
          <h2 class="sedes-title">GESTION DE SEDES</h2>
        </div>
      </div>

      <div class="flex justify-items-end gap-2">
        <p-button
          label="Agregar Sede"
          icon="pi pi-plus"
          styleClass="sedes-pill"
          [routerLink]="['/admin/sedes/agregar-sede']"
        ></p-button>
      </div>
    </div>
  </p-card>

  <p-card>
    <div class="flex flex-column lg:flex-row lg:align-items-center lg:justify-content-between gap-3">
      <div class="sedes-search-container flex-1">
        <span class="sedes-search-label">Buscar Sede</span>

        <p-autoComplete
          class="sedes-search-input"
          [ngModel]="searchTerm()"
          (ngModelChange)="onSearchChange($event)"
          [suggestions]="sedeSuggestions()"
          field="nombre"
          (completeMethod)="onSearch($event)"
          (onSelect)="onSelectSede($event)"
          placeholder="Escribe codigo, nombre o ciudad..."
          style="background: transparent; color: var(--text-color);"
          [inputStyle]="{ width: '100%', background: 'transparent', color: 'var(--text-color)' }"
        >
          <ng-template let-item pTemplate="item">
            <div class="flex flex-column gap-1">
              <span class="font-medium">{{ item.nombre }}</span>
              <small class="text-500">{{ item.codigo }}</small>
            </div>
          </ng-template>
        </p-autoComplete>
      </div>

      <div class="flex align-items-center gap-2 sedes-filter-actions">
        <p-select
          [options]="viewOptions"
          optionLabel="label"
          optionValue="value"
          [ngModel]="viewMode()"
          (ngModelChange)="onViewModeChange($event)"
          placeholder="Todos"
          class="sedes-filter-select"
        ></p-select>

        <p-button
          label="Limpiar Filtros"
          icon="pi pi-filter-slash"
          severity="danger"
          styleClass="sedes-pill sedes-pill-danger"
          type="button"
          (click)="clearSearch()"
        ></p-button>
      </div>
    </div>
  </p-card>

  <p-toast position="top-right" />

  <div class="mb-3">
    <p-message *ngIf="loading()" severity="info" text="Cargando sedes..."></p-message>
    <p-message *ngIf="!loading() && error() as e" severity="error" [text]="e"></p-message>
  </div>

  <p-card>
    <div class="flex align-items-center justify-content-between mb-3">
      <div class="flex align-items-center gap-2">
        <span class="sedes-section-icon">
          <i class="pi pi-user"></i>
        </span>

        <span class="text-sm font-semibold text-700">
          {{
            viewMode() === 'activas'
              ? 'SEDES ACTIVAS'
              : viewMode() === 'inactivas'
                ? 'SEDES INACTIVAS'
                : 'SEDES (TODAS)'
          }}
        </span>

        <p-tag
          [value]="'[' + filteredSedes().length + '] Sedes'"
          [severity]="viewMode() === 'activas' ? 'success' : viewMode() === 'inactivas' ? 'danger' : 'info'"
        ></p-tag>
      </div>

      <p-button icon="pi pi-id-card" text severity="secondary" styleClass="sedes-icon-btn"></p-button>
    </div>

    <div *ngIf="filteredSedes().length === 0" class="sedes-empty-state">
      <div class="sedes-empty-icon">
        <i class="pi pi-search"></i>
      </div>
      <div class="sedes-empty-title">No hay sedes con ese filtro</div>
      <div class="sedes-empty-subtitle">
        Prueba con otro termino o limpia los filtros para ver todas las sedes.
      </div>
      <p-button
        label="Limpiar filtros"
        icon="pi pi-filter-slash"
        severity="danger"
        styleClass="sedes-pill sedes-pill-danger"
        type="button"
        (click)="clearSearch()"
      ></p-button>
    </div>

    <p-table
      *ngIf="filteredSedes().length > 0"
      [value]="filteredSedes()"
      styleClass="sedes-table"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [tableStyle]="{ 'min-width': '60rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>CODIGO</th>
          <th>NOMBRE</th>
          <th>CIUDAD</th>
          <th>TELEFONO</th>
          <th>DIRECCION</th>
          <th>ACCIONES</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-sede>
        <tr>
          <td>{{ sede.codigo }}</td>
          <td>{{ sede.nombre }}</td>
          <td>
            <span class="inline-flex align-items-center gap-2">
              <i class="pi pi-map-marker text-500"></i>
              {{ sede.ciudad }}
            </span>
          </td>
          <td>
            <span class="inline-flex align-items-center gap-2">
              <i class="pi pi-phone text-500"></i>
              {{ sede.telefono }}
            </span>
          </td>
          <td>{{ sede.direccion }}</td>
          <td>
            <div class="flex align-items-center gap-2">
              <p-button
                icon="pi pi-pencil"
                text
                severity="secondary"
                styleClass="sedes-icon-btn sedes-icon-warn"
                [routerLink]="['/admin/sedes/editar-sede']"
                [queryParams]="{ id: sede.id_sede }"
              ></p-button>

              <p-button
                [icon]="sede.activo ? 'pi pi-times' : 'pi pi-check'"
                text
                [severity]="sede.activo ? 'danger' : 'success'"
                styleClass="sedes-icon-btn"
                (click)="confirmToggleStatus(sede)"
                [title]="sede.activo ? 'Desactivar sede' : 'Activar sede'"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <p-confirmdialog />
  </p-card>
</div>