<div class="p-4">

  <!-- Breadcrumb -->
  <p-breadcrumb [model]="breadcrumbItems"></p-breadcrumb>

  <h2 class="mt-3 mb-4">Crear Nuevo Usuario</h2>

  <!-- Asignación de Rol -->
  <p-card header="Asignación de Rol" class="mb-4">
    <div class="grid">
      <div
        class="col-12 md:col-4"
        *ngFor="let rol of roles"
      >
        <div
          class="rol-card"
          [class.selected]="rolSeleccionado === rol.value"
          (click)="rolSeleccionado = rol.value"
        >
          <i class="pi {{ rol.icon }} rol-icon"></i>
          <h4>{{ rol.label }}</h4>
          <p>{{ rol.description }}</p>

          <p-radioButton
            name="rol"
            [value]="rol.value"
            [(ngModel)]="rolSeleccionado">
          </p-radioButton>
        </div>
      </div>
    </div>
  </p-card>

  <!-- Formularios -->
  <div class="grid">

    <!-- Datos personales -->
    <div class="col-12 md:col-6">
      <div class="h-full">
        <p-card header="Datos Personales" class="h-full">

          <div class="field">
            <label class="label-width">Nombre Completo</label>
            <input
              pInputText
              [(ngModel)]="usuario.nombre"
              placeholder="Ingrese el nombre completo"
              class="w-full" />
          </div>

          <div class="field">
            <label class="label-width">Sede Asignada</label>
            <div class="flex flex-column gap-2 w-full">
              <div
                class="flex align-items-center"
                *ngFor="let sede of sedes"
              >
                <p-radioButton
                  name="sede"
                  [value]="sede.value"
                  [(ngModel)]="usuario.sede">
                </p-radioButton>
                <label class="ml-2">{{ sede.label }}</label>
              </div>
            </div>
          </div>

          <div class="field">
            <label class="label-width">Correo Electrónico</label>
            <input
              pInputText
              type="email"
              [(ngModel)]="usuario.correo"
              placeholder="correo@ejemplo.com"
              class="w-full" />
          </div>

        </p-card>
      </div>
    </div>

    <!-- Credenciales -->
    <div class="col-12 md:col-6">
      <div class="h-full">
        <p-card header="Credenciales de Acceso" class="h-full">

          <div class="field">
            <label class="label-width">Usuario</label>
            <input
              pInputText
              [(ngModel)]="usuario.username"
              placeholder="Nombre de usuario"
              class="w-full" />
          </div>

          <div class="field">
            <label class="label-width">Contraseña</label>
            <p-password
              [(ngModel)]="usuario.password"
              [toggleMask]="true"
              placeholder="Contraseña"
              styleClass="w-full">
            </p-password>
          </div>

          <div class="field">
            <label class="label-width">Confirmar Contraseña</label>
            <p-password
              [(ngModel)]="usuario.confirmPassword"
              [toggleMask]="true"
              placeholder="Confirmar contraseña"
              styleClass="w-full">
            </p-password>
          </div>

        </p-card>
      </div>
    </div>

  </div>

  <!-- Botón -->
  <div class="flex justify-content-end mt-4">
    <button
      pButton
      type="button"
      label="Crear Usuario"
      icon="pi pi-save"
      (click)="guardarUsuario()">
    </button>
  </div>

  <p-divider></p-divider>

  <!-- Lista de Usuarios -->
  <p-card header="Lista de Usuarios Registrados" class="mt-4">
    <p-table 
      [value]="usuarios" 
      [loading]="cargandoUsuarios"
      [paginator]="true" 
      [rows]="10"
      [showCurrentPageReport]="usuarios.length > 0"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} usuarios"
      [rowsPerPageOptions]="[5, 10, 25, 50]"
      styleClass="p-datatable-sm"
      [tableStyle]="{ 'min-width': '50rem' }">
      
      <ng-template pTemplate="header">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Apellidos</th>
          <th>Email</th>
          <th>DNI</th>
          <th>Celular</th>
          <th>Rol</th>
          <th>Sede</th>
          <th>Estado</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-usuario>
        <tr>
          <td>{{ usuario.id_usuario }}</td>
          <td>{{ usuario.usu_nom }}</td>
          <td>{{ usuario.ape_pat }} {{ usuario.ape_mat }}</td>
          <td>{{ usuario.email }}</td>
          <td>{{ usuario.dni }}</td>
          <td>{{ usuario.celular }}</td>
          <td>
            <p-tag 
              [value]="usuario.rol_nombre || 'Sin rol'" 
              [severity]="getRolSeverity(usuario.rol_nombre)">
            </p-tag>
          </td>
          <td>{{ usuario.sedeNombre || 'N/A' }}</td>
          <td>
            <p-tag 
              [value]="usuario.activo ? 'Activo' : 'Inactivo'" 
              [severity]="getEstadoSeverity(usuario.activo)">
            </p-tag>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" class="text-center">No hay usuarios registrados</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

</div>
