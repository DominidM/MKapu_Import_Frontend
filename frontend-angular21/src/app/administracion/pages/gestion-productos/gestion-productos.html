<!-- CABECERA (TU DISEÑO EXACTO) -->
<div class="p-2">
<p-card styleClass="productos-header-card mb-4 productos-header-bordered">
  <div class="flex align-items-center justify-content-between flex-wrap gap-2">
    <div class="flex align-items-center gap-3">
      <span class="productos-title-icon">
        <i class="pi pi-building"></i>
      </span>
      <div>
        <p class="productos-kicker mb-0">
          ADMINISTRADOR - ADMINISTRACION - PRODUCTOS ACTIVOS
        </p>
        <h2 class="productos-title mb-0">GESTIÓN DE PRODUCTOS</h2>
      </div>
    </div>

    <div class="flex gap-2">
      <p-button 
        icon="pi pi-trash" 
        severity="danger"
        styleClass="productos-pill productos-pill-danger"
        (onClick)="irEliminados()"
        [disabled]="!totalEliminados">
      </p-button>

      <p-button 
        label="Agregar Producto"
        icon="pi pi-plus"
        styleClass="productos-pill productos-pill-warning"
        (onClick)="irCrear()" 
        [disabled]="!sedeValue">
      </p-button>
    </div>
  </div>
</p-card>
</div>

<div class="p-2">
  <div *ngIf="!isRutaHija()">
    
    <!-- SEDE - PrimeNG Nativo -->
    <div class="surface-card border-round-xl shadow-1 p-4 mb-4">
      <div class="flex justify-content-between align-items-center">
        <div class="flex align-items-center gap-4">
          <i class="pi pi-home text-6xl text-primary"></i>
          <div class="flex flex-column gap-1">
            <label class="font-bold text-xs uppercase text-600">SELECCIONAR SEDE:</label>
            <p-select 
              [(ngModel)]="sedeValue"
              [options]="sedes"
              optionLabel="label"
              optionValue="value"
              placeholder="Elija una sede para gestionar productos..."
              (onChange)="onSelectSede()"
              class="w-24rem">
            </p-select>
          </div>
        </div>
        <p-tag 
          [value]="totalSedesActivas + ' ACTIVAS'" 
          severity="success"
          class="text-xs font-bold">
        </p-tag>
      </div>
    </div>

    <!-- FILTROS - PrimeNG Nativo -->
    <div class="surface-card border-round-xl shadow-1 mb-4">
      <div class="p-4">
        <div class="flex flex-wrap gap-4 align-items-end">
          <div class="flex flex-column flex-grow-1" style="min-width: 400px; flex: 2;">
            <label class="font-medium mb-2">Buscar Producto</label>
            <p-autocomplete 
              [(ngModel)]="buscarValue"
              [suggestions]="items"
              (completeMethod)="searchBuscar($event)"
              (onSelect)="filtrarPorBusqueda($event)"
              placeholder="Nombre o código del producto..."
              class="w-full"
              [disabled]="!sedeValue">
              <ng-template let-item pTemplate="item">
                <div class="flex align-items-center p-3 w-full hover:surface-hover border-round cursor-pointer">
                  <div class="flex flex-column ml-2">
                    <span class="font-medium">{{item.nombre}}</span>
                    <small class="text-500">{{item.codigo}} • {{item.familia}}</small>
                  </div>
                </div>
              </ng-template>
            </p-autocomplete>
          </div>

          <div class="flex flex-column w-16rem">
            <label class="font-medium mb-2">Familia</label>
            <p-select 
              [(ngModel)]="familiaValue"
              [options]="familias"
              optionLabel="label"
              optionValue="value"
              placeholder="Todas las familias"
              [disabled]="!sedeValue"
              (onChange)="onSelectFamilia()"
              class="w-full">
            </p-select>
          </div>

          <div class="flex gap-3 align-items-end">
            <p-toggleButton 
              [(ngModel)]="vistaLista" 
              onLabel="Lista" 
              offLabel="Tarjetas" 
              onIcon="pi pi-table"
              offIcon="pi pi-list">
            </p-toggleButton>
            <p-button 
              icon="pi pi-filter-slash" 
              label="Limpiar Filtros"
              severity="danger"
              size="small"
              (onClick)="limpiarFiltros()">
            </p-button>
          </div>
        </div>
      </div>
    </div>

    <!-- SIN SEDE -->
    <div *ngIf="!sedeValue" class="surface-card p-8 text-center mb-6 border-round-xl">
      <div class="flex flex-column align-items-center gap-4">
        <i class="pi pi-exclamation-triangle text-6xl text-warning"></i>
        <h3 class="text-2xl font-bold text-900 mb-2">¡Debe definir una Sede!</h3>
        <p class="text-xl text-600 m-0">Seleccione una sede arriba para poder ver y gestionar los productos</p>
      </div>
    </div>

    <!-- LISTA - PrimeNG Table Nativo -->
    <!-- TABLA - SIN pt, con styleClass -->
<div *ngIf="sedeValue && vistaLista && productos.length > 0" class="mb-6">
  <div class="surface-card border-round-xl shadow-1 overflow-hidden">
    <p-table 
      #dt
      [value]="productos"
      dataKey="id"
      [rows]="10"
      [rowsPerPageOptions]="[5,10,25,50]"
      [loading]="loading"
      [paginator]="true"
      [globalFilterFields]="['codigo','nombre','familia']"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first}-{last} de {totalRecords} productos"
      styleClass="productos-table-nativa">
      
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 15%">Código</th>
          <th style="width: 40%">Producto</th>
          <th style="width: 17%">Familia</th>
          <th style="width: 13%">Precio Unit.</th>
          <th style="width: 15%">Acciones</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-p>
        <tr>
          <td>{{p.codigo}}</td>
          <td>{{p.nombre}}</td>
          <td>{{p.familia}}</td>
          <td class="font-bold text-green-500">
            S/ {{p.precioUnidad | number:'1.2-2'}}
          </td>
          <td>
            <div class="flex align-items-center gap-2">
              <p-button icon="pi pi-eye" size="small" text severity="info" rounded pTooltip="Ver Detalles" (onClick)="irDetalle(p.id)"></p-button>
              <p-button icon="pi pi-pencil" size="small" text severity="warn" rounded pTooltip="Editar Producto" (onClick)="irEditar(p.id)"></p-button>
              <p-button icon="pi pi-trash" size="small" text severity="danger" rounded pTooltip="Eliminar Producto" (onClick)="eliminarProducto(p)"></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center py-6">
            <i class="pi pi-inbox text-4xl text-400 mb-3 block"></i>
            <p class="text-900 font-medium mb-0">No se encontraron productos</p>
            <p class="text-600 mt-2">Ajusta los filtros arriba</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>


    <!-- TARJETAS -->
    <div *ngIf="sedeValue && !vistaLista && productos.length > 0" class="grid mb-6">
      <div class="col-12 md:col-6 lg:col-4 xl:col-3" *ngFor="let p of productos; trackBy: trackByFn">
        <p-card class="h-full surface-card hover:shadow-4 transition-duration-200">
          <ng-template pTemplate="title" class="font-bold text-lg">{{p.nombre}}</ng-template>
          <ng-template pTemplate="subtitle" class="text-500">{{p.codigo}} • {{p.familia}}</ng-template>
          <div class="flex flex-wrap gap-2 mb-3 mt-2">
            <p-tag [value]="'S/ ' + (p.precioUnidad | number:'1.2-2')" severity="success" class="font-medium"></p-tag>
          </div>
          <div class="flex flex-wrap gap-2 pt-2">
            <p-button icon="pi pi-eye" severity="info" size="small" label="Detalle" class="flex-1" (onClick)="irDetalle(p.id)"></p-button>
            <p-button icon="pi pi-pencil" severity="success" size="small" label="Editar" class="flex-1" (onClick)="irEditar(p.id)"></p-button>
            <p-button icon="pi pi-trash" severity="danger" size="small" label="Eliminar" class="flex-1" (onClick)="eliminarProducto(p)"></p-button>
          </div>
        </p-card>
      </div>
    </div>

    <!-- SIN PRODUCTOS -->
    <div *ngIf="sedeValue && productos.length === 0" class="surface-card p-6 text-center py-8 border-round-xl">
      <i class="pi pi-inbox text-6xl text-400 mb-4 block"></i>
      <h3 class="text-2xl font-bold text-900 mb-2">Sin Productos</h3>
      <p class="text-600 mb-6">No hay productos activos en esta sede con los filtros aplicados</p>
      <div class="flex gap-3 justify-content-center">
        <p-button label="Limpiar Filtros" icon="pi pi-filter-slash" severity="warn" class="w-12rem" (click)="limpiarFiltros()"></p-button>
        <p-button label="Agregar Primer Producto" icon="pi pi-plus" severity="success" size="large" class="w-12rem" (click)="irCrear()"></p-button>
      </div>
    </div>
  </div>

  <!-- Router outlet -->
  <div class="router-child-outlet surface-section" style="min-height: 400px;">
    <router-outlet></router-outlet>
  </div>
</div>
