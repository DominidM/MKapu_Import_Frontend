<div class="p-2">
  <p-card class="productos-header-card mb-4 productos-header-bordered">
    <div class="flex align-items-center justify-content-between flex-wrap gap-2">
      <div class="flex align-items-center gap-3">
        <span class="productos-title-icon">
          <i [class]="iconoCabecera"></i>
        </span>
        <div>
          <p class="productos-kicker mb-0">{{ tituloKicker }}</p>
          <h2 class="productos-title mb-0">{{ subtituloKicker }}</h2>
        </div>
      </div>
      <div class="flex gap-2">
        <p-button *ngIf="!esVistaEliminados" icon="pi pi-trash" [outlined]="true" severity="danger"
          styleClass="productos-pill productos-pill-danger-outlined" [pTooltip]="6 + ' productos eliminados'">
        </p-button>

        <p-button *ngIf="esVistaEliminados" icon="pi pi-arrow-left" [outlined]="true" severity="secondary"
          styleClass="productos-pill productos-pill-secondary" pTooltip="Volver a productos activos">
        </p-button>

        <p-button label="Agregar Producto" icon="pi pi-plus" styleClass="productos-pill productos-pill-warning"
          (onClick)="irCrear()"> </p-button>
      </div>
    </div>
  </p-card>
</div>


<div class="p-2">
  <div>
    <div class="contadores-productos mb-4">
      <div class="contador-card">
        <i class="pi pi-box"></i>
        <div>
          <span class="contador-label">Total Productos</span>
          <span class="contador-valor">{{ totalRecords() }}</span>
          <span class="contador-detalle"><i class="pi pi-check-circle"></i> En esta sede</span>
        </div>
      </div>

      <div class="contador-card">
        <i class="pi pi-tags"></i>
        <div>
          <span class="contador-label">Familias</span>
          <span class="contador-valor">{{ categorias().length }}</span>
          <span class="contador-detalle"><i class="pi pi-sitemap"></i> Categorías</span>
        </div>
      </div>

      <div class="contador-card">
        <i class="pi pi-building"></i>
        <div>
          <span class="contador-label">Sedes Activas</span>
          <span class="contador-valor">{{ sedesOptions().length }}</span>
          <span class="contador-detalle"><i class="pi pi-map-marker"></i> Ubicaciones</span>
        </div>
      </div>

      <div class="contador-card">
        <i class="pi pi-database"></i>
        <div>
          <span class="contador-label">Stock en Página</span>
          <span class="contador-valor">{{ stockTotalVisible() }}</span>
          <span class="contador-detalle"><i class="pi pi-arrow-up"></i> Unidades visibles</span>
        </div>
      </div>
    </div>

    <div class="surface-card border-round-xl shadow-1 mb-4">
      <div class="p-3">
        <div class="flex flex-wrap gap-6 align-items-end h-full">
          <div class="flex-1 p-fluid h-full">
            <label class="font-medium mb-2 block">Buscar Producto</label>

            <p-autocomplete [ngModel]="buscarValue()" (ngModelChange)="buscarValue.set($event)"
              [suggestions]="sugerencias()" (completeMethod)="searchBuscar($event)"
              (onSelect)="seleccionarProductoBusqueda($event)" (onClear)="limpiarBusqueda()"
              placeholder="Nombre o código del producto..." field="nombre" optionLabel="nombre" fluid [showClear]="true"
              styleClass="autocomplete-productos">
              <ng-template let-item pTemplate="item">
                <div class="autocomplete-item-custom p-2">
                  <div class="flex flex-column gap-1">
                    <span class="font-bold text-900">{{ item.nombre }}</span>
                    <small class="text-600 flex align-items-center gap-2">
                      <span><i class="pi pi-tag mr-1 text-primary"></i>{{ item.codigo }}</span>
                      <span><i class="pi pi-box mr-1 text-primary"></i>Stock: {{ item.stock }} unid.</span>
                    </small>
                  </div>
                </div>
              </ng-template>
            </p-autocomplete>

            <input *ngIf="esVistaEliminados" type="text" pInputText name="buscarEliminados"
              placeholder="Nombre o código del producto..." class="w-full" />
          </div>

          <div *ngIf="!esVistaEliminados" class="flex flex-column w-16rem h-full">
            <label class="font-medium mb-2 block">Familias</label>
            <p-select [options]="categorias()" [ngModel]="categoriaSeleccionada()"
              (ngModelChange)="onCategoriaChange($event)" placeholder="Filtrar por categoría" [showClear]="true"
              class="w-full">
            </p-select>
          </div>

          <div *ngIf="esVistaEliminados" class="flex flex-column w-16rem h-full">
            <label class="font-medium mb-2 block">Familiasss</label>
            <p-select [options]="categorias()" [ngModel]="categoriaSeleccionada()"
              (ngModelChange)="onCategoriaChange($event)" placeholder="Filtrar por categoría" [showClear]="true"
              class="w-full">
            </p-select>
          </div>

          <div class="flex flex-column w-16rem h-full">
            <label class="font-medium mb-2 block">Filtrar por Sede</label>
            <p-select name="sedeSelect" [options]="sedesOptions()" [ngModel]="idSedeActual()"
              (ngModelChange)="onSedeChange($event)" optionLabel="label" optionValue="value"
              placeholder="Seleccione una sede" class="w-full" [showClear]="true">
            </p-select>
          </div>

          <div class="flex gap-3 align-items-center">
            <p-toggleButton name="vistaToggleActivos" [onLabel]="'Lista'" [offLabel]="'Tarjetas'"
              [onIcon]="'pi pi-table'" [offIcon]="'pi pi-list'" />

            <p-toggleButton *ngIf="esVistaEliminados" name="vistaToggleEliminados" [onLabel]="'Lista'"
              [offLabel]="'Tarjetas'" [onIcon]="'pi pi-table'" [offIcon]="'pi pi-list'" />

            <p-button icon="pi pi-filter-slash" label="Limpiar" severity="danger" size="small">
            </p-button>
          </div>
        </div>
      </div>
    </div>

      <div class="mb-6">
        <div class="surface-card border-round-xl shadow-1 overflow-hidden">
          <p-table [value]="productos()" [lazy]="true" (onLazyLoad)="onPageChange($event)" [rows]="5"
            [totalRecords]="totalRecords()" [loading]="loading()" [paginator]="true"
            [rowsPerPageOptions]="[5, 10, 25, 50]" styleClass="productos-table-nativa productos-table-hover">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 15%">Código</th>
                <th style="width: 35%">Producto</th>
                <th style="width: 15%">Familia</th>
                <th style="width: 12%">Sedes</th>
                <th style="width: 12%">Stock Total</th>
                <th style="width: 11%">Acciones</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-p>
              <tr>
                <td class="font-semibold">{{ p.codigo }}</td>
                <td>{{ p.nombre }}</td>
                <td>{{ p.familia }}</td>
                <td>
                  <p-tag [value]="p.sede" severity="info" styleClass="font-bold"></p-tag>
                </td>
                <td>
                  <p-tag [value]="p.stock + ' unid.'" styleClass="font-bold">
                  </p-tag>
                </td>
                <td>
                  <div class="flex align-items-center gap-2">
                    <p-button icon="pi pi-eye" text severity="secondary"
                      styleClass="productos-icon-btn productos-icon-soft" pTooltip="Ver Detalles"
                      (onClick)="irDetalle(p.id_producto)">
                    </p-button>

                    <p-button icon="pi pi-pencil" text severity="secondary"
                      styleClass="productos-icon-btn productos-icon-warn" pTooltip="Editar Producto"
                      (onClick)="irEditar(p.id_producto)">
                    </p-button>

                    <p-button icon="pi pi-trash" text severity="danger"
                      styleClass="productos-icon-btn productos-icon-danger" pTooltip="Eliminar Producto">
                    </p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6" class="text-center py-6">
                  <i class="pi pi-inbox text-4xl text-400 mb-3 block"></i>
                  <p class="text-900 font-medium mb-0">No se encontraron productos</p>
                  <p class="text-600 mt-2">Ajusta los filtros arriba</p>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
</div>


    <!--
<p-dialog
  [(visible)]="mostrarDialogEliminar"
  [modal]="true"
  [style]="{ width: '550px' }"
  [draggable]="false"
  [resizable]="false"
  styleClass="border-round-xl"
  header="Seleccionar Sede a Eliminar"
>
  <div class="py-3">
    <p class="text-600 mb-4">
      Este producto está en <strong>{{ 10 }} sedes</strong>.
      Selecciona qué deseas eliminar:
    </p>

    <div class="flex flex-column gap-2">
      <div
        class="p-3 border-round-lg border-1 surface-border hover:surface-hover cursor-pointer"
      >
        <div class="flex justify-content-between align-items-center">
          <div class="flex align-items-center gap-3">
            <i class="pi pi-building text-2xl text-primary"></i>
            <div>
              <span class="font-bold block">
                {{ 'Sin sede' }}
              </span>
              <small class="text-500">Stock: {{  0 }} unidades</small>
            </div>
          </div>
          <i class="pi pi-trash text-red-500"></i>
        </div>
      </div>

      <div
        class="p-3 border-round-lg bg-red-50 border-1 border-red-200 hover:bg-red-100 cursor-pointer mt-2"
      >
        <div class="flex justify-content-between align-items-center">
          <div class="flex align-items-center gap-3">
            <i class="pi pi-exclamation-triangle text-2xl text-red-600"></i>
            <span class="font-bold text-red-600">Eliminar todas las sedes</span>
          </div>
          <i class="pi pi-trash text-red-600"></i>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button label="Cancelar" severity="secondary"></p-button>
  </ng-template>
</p-dialog>
-->

  <p-toast></p-toast>
  <p-confirmdialog></p-confirmdialog>