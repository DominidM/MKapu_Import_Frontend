<div class="p-4">
  <!-- CABECERA MEJORADA CON ICONO -->
  <div class="surface-card border-1 border-300 border-round-xl shadow-1 p-4 mb-4">
    <div class="flex justify-content-between align-items-center flex-wrap gap-3">
      <div class="flex align-items-center gap-3">
        <!-- ICONO CIRCULAR A LA IZQUIERDA -->
        <span class="productos-title-icon">
          <i [class]="isEditMode ? 'pi pi-pencil' : 'pi pi-plus-circle'"></i>
        </span>
        
        <!-- TEXTOS -->
        <div>
          <p class="productos-kicker mb-0">
            {{ isEditMode ? 'EDITAR PRODUCTO' : 'CREAR NUEVO PRODUCTO' }}
          </p>
          <h2 class="productos-title mb-0">
            {{ isEditMode ? (productoOriginal?.nombre || 'Cargando...') : 'Nuevo Producto' }}
          </h2>
        </div>
      </div>
      
      <!-- BOTÓN VOLVER -->
      <div class="flex gap-2 flex-wrap">
        <p-button 
          label="Volver" 
          icon="pi pi-arrow-left" 
          severity="secondary"
          styleClass="productos-pill productos-pill-secondary"
          (onClick)="volver()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- FORMULARIO -->
  <p-card styleClass="border-1 border-300 border-round-xl shadow-2">
    <form [formGroup]="productoForm" (ngSubmit)="guardar()" class="formgrid grid p-4">
      
      <!-- CÓDIGO -->
      <div class="field col-12 md:col-6 mb-4">
        <label for="codigo" class="font-semibold text-900 mb-2 block">Código *</label>
        <input 
          pInputText 
          id="codigo" 
          formControlName="codigo" 
          class="w-full border-1 border-300" 
          placeholder="Ej: RAF-REF001, RAF-LAV002"
        />
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('codigo')?.invalid && productoForm.get('codigo')?.touched">
          El código es requerido
        </small>
      </div>

      <!-- NOMBRE -->
      <div class="field col-12 md:col-6 mb-4">
        <label for="nombre" class="font-semibold text-900 mb-2 block">Nombre *</label>
        <input 
          pInputText 
          id="nombre" 
          formControlName="nombre" 
          class="w-full border-1 border-300" 
          placeholder="Ej: Refrigeradora LG 300L, Licuadora Oster"
        />
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('nombre')?.invalid && productoForm.get('nombre')?.touched">
          El nombre es requerido
        </small>
      </div>

      <!-- SEDE -->
      <div class="field col-12 md:col-6 mb-4">
        <label for="sede" class="font-semibold text-900 mb-2 block">Sede *</label>
        <p-select 
          id="sede"
          formControlName="sede" 
          [options]="sedes" 
          placeholder="Seleccionar sede"
          styleClass="w-full border-1 border-300">
        </p-select>
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('sede')?.invalid && productoForm.get('sede')?.touched">
          La sede es requerida
        </small>
      </div>

      <!-- FAMILIA -->
      <div class="field col-12 md:col-6 mb-4">
        <label for="familia" class="font-semibold text-900 mb-2 block">Familia *</label>
        <p-select 
          id="familia"
          formControlName="familia" 
          [options]="familias" 
          placeholder="Seleccionar familia"
          styleClass="w-full border-1 border-300">
        </p-select>
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('familia')?.invalid && productoForm.get('familia')?.touched">
          La familia es requerida
        </small>
      </div>

      <!-- SEPARADOR -->
      <div class="col-12 mb-3">
        <div class="border-top-1 border-300"></div>
      </div>

      <!-- PRECIO UNIDAD -->
      <div class="field col-12 md:col-4 mb-4">
        <label for="precioUnidad" class="font-semibold text-900 mb-2 block">Precio Unidad (S/) *</label>
        <p-inputNumber 
          id="precioUnidad"
          formControlName="precioUnidad" 
          mode="currency" 
          currency="PEN" 
          locale="es-PE"
          styleClass="w-full"
          [min]="0"
          placeholder="S/ 0.00">
        </p-inputNumber>
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('precioUnidad')?.invalid && productoForm.get('precioUnidad')?.touched">
          El precio es requerido
        </small>
      </div>

      <!-- PRECIO CAJA -->
      <div class="field col-12 md:col-4 mb-4">
        <label for="precioCaja" class="font-semibold text-900 mb-2 block">Precio Caja (S/) *</label>
        <p-inputNumber 
          id="precioCaja"
          formControlName="precioCaja" 
          mode="currency" 
          currency="PEN" 
          locale="es-PE"
          styleClass="w-full"
          [min]="0"
          placeholder="S/ 0.00">
        </p-inputNumber>
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('precioCaja')?.invalid && productoForm.get('precioCaja')?.touched">
          El precio es requerido
        </small>
      </div>

      <!-- PRECIO MAYORISTA -->
      <div class="field col-12 md:col-4 mb-4">
        <label for="precioMayorista" class="font-semibold text-900 mb-2 block">Precio Mayorista (S/) *</label>
        <p-inputNumber 
          id="precioMayorista"
          formControlName="precioMayorista" 
          mode="currency" 
          currency="PEN" 
          locale="es-PE"
          styleClass="w-full"
          [min]="0"
          placeholder="S/ 0.00">
        </p-inputNumber>
        <small class="text-red-500 block mt-2" *ngIf="productoForm.get('precioMayorista')?.invalid && productoForm.get('precioMayorista')?.touched">
          El precio es requerido
        </small>
      </div>

      <!-- SEPARADOR -->
      <div class="col-12 mb-3">
        <div class="border-top-1 border-300"></div>
      </div>

      <!-- INFO PRODUCTO ORIGINAL (Solo en modo edición) -->
      <div class="field col-12 mb-4" *ngIf="isEditMode && productoOriginal">
        <div class="surface-50 border-round p-3 border-1 border-300">
          <div class="flex align-items-center gap-3">
            <i class="pi pi-info-circle text-2xl text-primary"></i>
            <div>
              <p class="m-0 font-semibold text-900">Editando producto: {{ productoOriginal.nombre }}</p>
              <p class="m-0 text-sm text-600 mt-1">
                Código: <span class="font-semibold text-primary">{{ productoOriginal.codigo }}</span> | 
                Estado: <span class="font-semibold text-green-600">{{ productoOriginal.estado }}</span> | 
                Sede: <span class="font-semibold">{{ productoOriginal.sede }}</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- BOTONES DE ACCIÓN -->
      <div class="field col-12 flex gap-3 justify-content-end pt-3">
        <p-button 
          type="button" 
          label="Cancelar" 
          severity="secondary" 
          icon="pi pi-times"
          styleClass="w-10rem"
          (onClick)="volver()">
        </p-button>
        
        <p-button 
          type="submit" 
          [label]="isEditMode ? 'Actualizar' : 'Guardar'"
          [icon]="isEditMode ? 'pi pi-refresh' : 'pi pi-check'"
          styleClass="productos-pill productos-pill-warning w-10rem"
          [disabled]="!productoForm.valid">
        </p-button>
      </div>
      
    </form>
  </p-card>
</div>

<!-- COMPONENTES DE MENSAJES -->
<p-toast></p-toast>
<p-confirmdialog [baseZIndex]="10000"></p-confirmdialog>
