<div class="p-4">

  <!-- ================= HEADER ================= -->
  <div class="comision-page">

    <!-- ================= HEADER ================= -->
    <p-card styleClass="sedes-header-card">
  
      <div class="flex align-items-center justify-content-between flex-wrap gap-3">
  
        <!-- TITULO -->
        <div class="flex align-items-center gap-3">
  
          <span class="sedes-title-icon">
            <i class="pi pi-chart-line"></i>
          </span>
  
          <div>
            <p class="sedes-kicker">
              ADMINISTRADOR · ALMACÉN · INVENTARIO
            </p>
            <h2 class="sedes-title">
              CONTEOS DE INVENTARIO
            </h2>
          </div>
  
        </div>
  
        <!-- BOTÓN ACCIÓN -->
        <div class="flex gap-2">
  
          <p-button
            label="Nuevo Conteo"
            icon="pi pi-plus"
            styleClass="sedes-pill"
            [routerLink]="['/admin/conteo-crear']">
          </p-button>
  
        </div>
  
      </div>
  
    </p-card>
  
  </div>
  

  <!-- ================= FILTROS ================= -->
  <p-card class="mb-4 surface-50">

    <div class="flex align-items-center gap-2 mb-3">
      <i class="pi pi-filter text-primary"></i>
      <h4 class="m-0">Filtros</h4>
    </div>
  
    <div class="grid">
  
      <!-- Fecha -->
      <div class="col-12 md:col-3">
        <label class="text-500 block mb-2">
          <i class="pi pi-calendar mr-1"></i>
          Fecha
        </label>
        <p-datepicker
          [(ngModel)]="fechaSeleccionada"
          dateFormat="dd/mm/yy"
          (onSelect)="aplicarFiltros()"
          [showIcon]="true"
          placeholder="Seleccionar fecha">
        </p-datepicker>
      </div>
  
      <!-- Buscador -->
      <div class="col-12 md:col-3">
        <label class="text-500 block mb-2">
          <i class="pi pi-search mr-1"></i>
          Buscar
        </label>
        <input
          pInputText
          type="text"
          class="w-full"
          placeholder="Buscar por detalle..."
          [(ngModel)]="filtroBusqueda"
          (input)="aplicarFiltros()" />
      </div>
  
      <!-- Estado -->
      <div class="col-12 md:col-3">
        <label class="text-500 block mb-2">
          <i class="pi pi-flag mr-1"></i>
          Estado
        </label>
        <p-autoComplete
          [(ngModel)]="estadoSeleccionado"
          [suggestions]="estadosFiltrados"
          (completeMethod)="filtrarEstados($event)"
          (onSelect)="aplicarFiltros()"
          optionLabel="nombre"
          [dropdown]="true"
          placeholder="Seleccionar estado">
        </p-autoComplete>
      </div>
  
      <!-- Familia -->
      <div class="col-12 md:col-3">
        <label class="text-500 block mb-2">
          <i class="pi pi-box mr-1"></i>
          Familia
        </label>
        <p-autoComplete
          [(ngModel)]="familiaSeleccionada"
          [suggestions]="familiasFiltradas"
          (completeMethod)="filtrarFamilias($event)"
          (onSelect)="aplicarFiltros()"
          optionLabel="nombre"
          [dropdown]="true"
          placeholder="Seleccionar familia">
        </p-autoComplete>
      </div>
  
    </div>
  
  </p-card>
  

  <!-- ================= TABLA ================= -->
  <p-card>

    <div class="flex align-items-center gap-2 mb-3">
      <i class="pi pi-list text-primary"></i>
      <h3 class="m-0">Listado de Conteos</h3>
    </div>

    <p-table
      [value]="conteosFiltrados"
      responsiveLayout="scroll"
      stripedRows
      showGridlines>

      <ng-template pTemplate="header">
        <tr>
          <th><i class="pi pi-calendar mr-2"></i>Fecha</th>
          <th><i class="pi pi-file mr-2"></i>Detalle</th>
          <th><i class="pi pi-flag mr-2"></i>Estado</th>
          <th><i class="pi pi-box mr-2"></i>Familia</th>
          <th class="text-center">
            <i class="pi pi-cog mr-2"></i>Acción
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row>
        <tr>

          <td>
            <span class="font-semibold">{{ row.fecha }}</span>
          </td>

          <td>
            <div class="font-semibold">
              {{ row.detalle }}
            </div>
            <small class="text-500">
              Conteo registrado
            </small>
          </td>

          <td>
            <p-tag
              [value]="row.estado"
              [severity]="
                row.estado === 'Finalizado' ? 'success' :
                row.estado === 'Anulado' ? 'danger' :
                'warn'
              ">
            </p-tag>
          </td>

          <td>
            <span class="font-medium">
              {{ row.familia }}
            </span>
          </td>

          <td class="text-center">
            <p-button
              icon="pi pi-eye"
              label="Ver"
              severity="info"
              size="small"
              [routerLink]="['/admin/conteo-detalle', row.id]">
            </p-button>
          </td>

        </tr>
      </ng-template>

    </p-table>

    <div *ngIf="conteosFiltrados.length === 0"
         class="text-center p-5 text-500">
      <i class="pi pi-info-circle mr-2"></i>
      No se encontraron conteos con los filtros aplicados.
    </div>

  </p-card>

</div>
