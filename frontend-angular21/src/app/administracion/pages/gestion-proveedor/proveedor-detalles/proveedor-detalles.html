<!-- src/app/administracion/pages/proveedores/proveedor-detalles/proveedor-detalles.html -->

<div class="p-4" *ngIf="proveedor()">
  <div class="surface-card border-1 border-300 border-round-xl shadow-1 p-4 mb-4">
    <div class="flex justify-content-between align-items-center flex-wrap gap-3">
      <div class="flex align-items-center gap-3">
        <span class="proveedores-title-icon">
          <i class="pi pi-eye"></i>
        </span>
        <div>
          <p class="proveedores-kicker mb-0">DETALLES DEL PROVEEDOR</p>
          <h2 class="proveedores-title mb-0">{{ proveedor()!.razon_social }}</h2>
        </div>
      </div>

      <div class="flex gap-2 flex-wrap">
        <p-button
          label="Volver"
          icon="pi pi-arrow-left"
          severity="secondary"
          styleClass="proveedores-pill proveedores-pill-secondary"
          (onClick)="volver()"
        >
        </p-button>
      </div>
    </div>
  </div>

  <div class="grid">
    <!-- Información General -->
    <div class="col-12 lg:col-8">
      <p-card styleClass="border-1 border-300 border-round-xl shadow-2 h-full">
        <div class="flex align-items-center gap-3 mb-4">
          <i class="pi pi-info-circle text-3xl text-primary"></i>
          <h3 class="m-0 text-xl font-bold text-900">Información General</h3>
        </div>

        <p-divider></p-divider>

        <div class="grid">
          <div class="col-12 md:col-6 mb-4">
            <label class="block text-sm font-semibold text-600 mb-2">RUC</label>
            <div class="flex align-items-center gap-2 p-3 bg-primary-50 border-round-lg">
              <i class="pi pi-id-card text-primary text-xl"></i>
              <span class="text-2xl font-black text-primary flex-1">{{ proveedor()!.ruc }}</span>
              <p-button
                icon="pi pi-copy"
                [text]="true"
                [rounded]="true"
                severity="secondary"
                size="small"
                pTooltip="Copiar RUC"
                (onClick)="copiarAlPortapapeles(proveedor()!.ruc, 'RUC')"
              ></p-button>
            </div>
          </div>

          <div class="col-12 md:col-6 mb-4">
            <label class="block text-sm font-semibold text-600 mb-2">ESTADO</label>
            <div class="p-3">
              <p-tag
                [value]="estadoLabel()"
                [severity]="estadoSeverity()"
                styleClass="text-lg font-bold px-4 py-2"
              >
              </p-tag>
            </div>
          </div>

          <div class="col-12 mb-4">
            <label class="block text-sm font-semibold text-600 mb-2">RAZÓN SOCIAL</label>
            <div class="p-3 surface-50 border-round-lg border-1 border-300">
              <p class="m-0 text-xl font-semibold text-900">{{ proveedor()!.razon_social }}</p>
            </div>
          </div>

          <div class="col-12 mb-4" *ngIf="tieneDireccion()">
            <label class="block text-sm font-semibold text-600 mb-2">DIRECCIÓN FISCAL</label>
            <div class="p-3 surface-50 border-round-lg border-1 border-300">
              <p class="m-0 text-base text-700 line-height-3">{{ proveedor()!.dir_fiscal }}</p>
            </div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Información de Contacto -->
    <div class="col-12 lg:col-4">
      <p-card styleClass="border-1 border-300 border-round-xl shadow-2 h-full">
        <div class="flex align-items-center gap-3 mb-4">
          <i class="pi pi-phone text-3xl text-green-600"></i>
          <h3 class="m-0 text-xl font-bold text-900">Contacto</h3>
        </div>

        <p-divider></p-divider>

        <div class="flex flex-column gap-4">
          <div class="p-4 bg-blue-50 border-round-xl border-2 border-blue-200" *ngIf="tieneContacto()">
            <label class="block text-xs font-bold text-blue-700 mb-2 uppercase">Persona de Contacto</label>
            <div class="flex align-items-center gap-2">
              <i class="pi pi-user text-blue-600 text-xl"></i>
              <span class="text-xl font-bold text-blue-600">{{ proveedor()!.contacto }}</span>
            </div>
          </div>

          <div class="p-4 bg-green-50 border-round-xl border-2 border-green-200" *ngIf="tieneTelefono()">
            <label class="block text-xs font-bold text-green-700 mb-2 uppercase">Teléfono</label>
            <div class="flex align-items-center justify-content-between gap-2">
              <div class="flex align-items-center gap-2">
                <i class="pi pi-phone text-green-600 text-xl"></i>
                <span class="text-xl font-bold text-green-600">{{ proveedor()!.telefono }}</span>
              </div>
              <p-button
                icon="pi pi-copy"
                [text]="true"
                [rounded]="true"
                severity="success"
                size="small"
                pTooltip="Copiar teléfono"
                (onClick)="copiarAlPortapapeles(proveedor()!.telefono!, 'Teléfono')"
              ></p-button>
            </div>
          </div>

          <div class="p-4 bg-orange-50 border-round-xl border-2 border-orange-200" *ngIf="tieneEmail()">
            <label class="block text-xs font-bold text-orange-700 mb-2 uppercase">Email</label>
            <div class="flex align-items-center justify-content-between gap-2">
              <div class="flex align-items-center gap-2 flex-1 overflow-hidden">
                <i class="pi pi-envelope text-orange-600 text-xl"></i>
                <span class="text-base font-bold text-orange-600 truncate">{{ proveedor()!.email }}</span>
              </div>
              <p-button
                icon="pi pi-copy"
                [text]="true"
                [rounded]="true"
                severity="warn"
                size="small"
                pTooltip="Copiar email"
                (onClick)="copiarAlPortapapeles(proveedor()!.email!, 'Email')"
              ></p-button>
            </div>
          </div>

          <div class="p-4 surface-100 border-round-xl text-center" *ngIf="!tieneContacto() && !tieneTelefono() && !tieneEmail()">
            <i class="pi pi-info-circle text-3xl text-400 mb-2"></i>
            <p class="m-0 text-sm text-600">Sin información de contacto registrada</p>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Estadísticas Rápidas -->
    <div class="col-12">
      <p-card styleClass="border-1 border-300 border-round-xl shadow-2">
        <div class="flex align-items-center gap-3 mb-4">
          <i class="pi pi-chart-bar text-3xl text-purple-600"></i>
          <h3 class="m-0 text-xl font-bold text-900">Datos Adicionales</h3>
        </div>

        <p-divider></p-divider>

        <div class="grid">
          <div class="col-12 md:col-6 lg:col-3">
            <div class="p-3 estadistica-box estadistica-promedio border-round-lg text-center">
              <label class="block text-xs font-bold mb-2 uppercase estadistica-label">RUC Verificado</label>
              <div class="flex align-items-center justify-content-center gap-2">
                <i class="pi pi-verified text-2xl estadistica-icono"></i>
                <span class="text-xl font-black estadistica-valor">Sí</span>
              </div>
            </div>
          </div>

          <div class="col-12 md:col-6 lg:col-3">
            <div class="p-3 estadistica-box estadistica-minimo border-round-lg text-center">
              <label class="block text-xs font-bold mb-2 uppercase estadistica-label">Datos Completos</label>
              <div class="flex align-items-center justify-content-center gap-2">
                <i class="pi pi-check-circle text-2xl estadistica-icono"></i>
                <span class="text-xl font-black estadistica-valor">
                  {{ (tieneContacto() ? 25 : 0) + (tieneEmail() ? 25 : 0) + (tieneTelefono() ? 25 : 0) + (tieneDireccion() ? 25 : 0) }}%
                </span>
              </div>
            </div>
          </div>

          <div class="col-12 md:col-6 lg:col-3">
            <div class="p-3 estadistica-box estadistica-maximo border-round-lg text-center">
              <label class="block text-xs font-bold mb-2 uppercase estadistica-label">Campos Opcionales</label>
              <div class="flex align-items-center justify-content-center gap-2">
                <i class="pi pi-list text-2xl estadistica-icono"></i>
                <span class="text-xl font-black estadistica-valor">
                  {{ (tieneContacto() ? 1 : 0) + (tieneEmail() ? 1 : 0) + (tieneTelefono() ? 1 : 0) + (tieneDireccion() ? 1 : 0) }}/4
                </span>
              </div>
            </div>
          </div>

          <div class="col-12 md:col-6 lg:col-3">
            <div class="p-3 estadistica-box estadistica-diferencia border-round-lg text-center">
              <label class="block text-xs font-bold mb-2 uppercase estadistica-label">Estado Actual</label>
              <div class="flex align-items-center justify-content-center gap-2">
                <i [class]="proveedor()!.estado ? 'pi pi-check-circle text-2xl estadistica-icono' : 'pi pi-times-circle text-2xl estadistica-icono'"></i>
                <span class="text-xl font-black estadistica-valor">{{ estadoLabel() }}</span>
              </div>
            </div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Acciones -->
    <div class="col-12">
      <p-card styleClass="border-1 border-300 border-round-xl shadow-2">
        <div class="flex justify-content-between align-items-center flex-wrap gap-3">
          <div class="flex align-items-center gap-3">
            <i class="pi pi-cog text-2xl text-600"></i>
            <h3 class="m-0 text-lg font-bold text-900">Acciones</h3>
          </div>

          <div class="flex gap-2 flex-wrap">
            <p-button
              [label]="proveedor()!.estado ? 'Desactivar' : 'Activar'"
              [icon]="proveedor()!.estado ? 'pi pi-times' : 'pi pi-check'"
              [severity]="proveedor()!.estado ? 'warn' : 'success'"
              [outlined]="true"
              styleClass="proveedores-pill"
              (onClick)="cambiarEstado($event)"
            >
            </p-button>

            <p-button
              label="Eliminar"
              icon="pi pi-trash"
              severity="danger"
              [outlined]="true"
              styleClass="proveedores-pill proveedores-pill-danger"
              (onClick)="eliminarProveedor($event)"
            >
            </p-button>

            <p-button
              label="Editar"
              icon="pi pi-pencil"
              severity="warn"
              [outlined]="true"
              styleClass="proveedores-pill proveedores-pill-warning"
              (onClick)="irEditar()"
            >
            </p-button>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div>

<div *ngIf="!proveedor() && !loading()" class="surface-card p-8 text-center mb-6 border-round-xl">
  <div class="flex flex-column align-items-center gap-4">
    <i class="pi pi-exclamation-triangle text-6xl text-warning"></i>
    <h3 class="text-2xl font-bold text-900 mb-2">Proveedor No Encontrado</h3>
    <p class="text-xl text-600 m-0">El proveedor que buscas no existe o fue eliminado</p>
    <p-button
      label="Volver a Proveedores"
      icon="pi pi-arrow-left"
      [outlined]="true"
      size="large"
      (onClick)="volver()"
    ></p-button>
  </div>
</div>

<p-toast></p-toast>
<p-confirmdialog></p-confirmdialog>
