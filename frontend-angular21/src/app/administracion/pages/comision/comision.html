<div class="comision-page">

    <!-- ================= HEADER ================= -->
    <p-card class="sedes-header-card">
      <div class="flex align-items-center justify-content-between flex-wrap gap-3">
  
        <!-- TITULO -->
        <div class="flex align-items-center gap-3">
          <span class="sedes-title-icon">
            <i class="pi pi-wallet"></i>
          </span>
          <div>
            <p class="sedes-kicker">
              ADMINISTRADOR · ADMINISTRACIÓN · COMISIONES
            </p>
            <h2 class="sedes-title">
              GESTIÓN DE REGLAS DE COMISIÓN
            </h2>
          </div>
        </div>
  
        <!-- BOTÓN CREAR REGLA (MISMO PATRÓN QUE AGREGAR SEDE) -->
        <div class="flex justify-items-end gap-2">

            <p-button
            label="Reportes"
            icon="pi pi-book"
            styleClass="sedes-pill"
            [routerLink]="['/admin/comision-reportes']">
          </p-button>



          <p-button
            label="Crear Regla"
            icon="pi pi-plus"
            styleClass="sedes-pill"
            [routerLink]="['/admin/comision-regla']">
          </p-button>

        </div>
  
      </div>
    </p-card>
  
    <!-- ================= STATS ================= -->
    <div class="comision-metrics grid">
  
      <!-- REGLAS ACTIVAS -->
      <div class="col-12 md:col-6 xl:col-4">
        <p-card class="metric-card metric-info">
          <div class="metric-header">
            <span class="metric-title">Reglas Activas</span>
            <span class="metric-icon metric-icon-info">
              <i class="pi pi-list"></i>
            </span>
          </div>
          <div class="metric-value">{{ totalReglasActivas }}</div>
          <div class="metric-sub">Reglas configuradas</div>
        </p-card>
      </div>
  
      <!-- CATEGORÍAS -->
      <div class="col-12 md:col-6 xl:col-4">
        <p-card class="metric-card metric-success">
          <div class="metric-header">
            <span class="metric-title">Categorías</span>
            <span class="metric-icon metric-icon-success">
              <i class="pi pi-tags"></i>
            </span>
          </div>
          <div class="metric-value">{{ totalCategorias }}</div>
          <div class="metric-sub">Familias con comisión</div>
        </p-card>
      </div>
  
      <!-- PROMEDIO COMISIÓN -->
      <div class="col-12 md:col-6 xl:col-4">
        <p-card class="metric-card metric-warning">
          <div class="metric-header">
            <span class="metric-title">Promedio Comisión</span>
            <span class="metric-icon metric-icon-warning">
              <i class="pi pi-percentage"></i>
            </span>
          </div>
          <div class="metric-value">
            S/ {{ promedioComision | number:'1.2-2' }}
          </div>
          <div class="metric-sub">Valor promedio por regla</div>
        </p-card>
      </div>
  
    </div>
  
    <!-- ================= TABLA ================= -->
    <p-card>
  
      <div class="flex align-items-center justify-content-between mb-3">
        <div class="flex align-items-center gap-2">
          <span class="sedes-section-icon">
            <i class="pi pi-list"></i>
          </span>
          <span class="text-sm font-semibold">
            REGLAS EXISTENTES
          </span>
          <p-tag
            [value]="'[' + reglas.length + '] Reglas'"
            severity="info">
          </p-tag>
        </div>
  
        <div class="flex gap-2">
          <p-button icon="pi pi-filter" text severity="secondary"></p-button>
          <p-button icon="pi pi-sort-alt" text severity="secondary"></p-button>
        </div>
      </div>
  
      <!-- EMPTY STATE -->
      <div *ngIf="reglas.length === 0" class="sedes-empty-state">
        <div class="sedes-empty-icon">
          <i class="pi pi-inbox"></i>
        </div>
        <div class="sedes-empty-title">
          No hay reglas registradas
        </div>
        <div class="sedes-empty-subtitle">
          Presiona “Crear Regla” para crear la primera.
        </div>
      </div>
  
      <!-- TABLE -->
      <p-table
        *ngIf="reglas.length > 0"
        [value]="reglas"
        styleClass="sedes-table"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[5,10,20]"
        [tableStyle]="{ 'min-width': '60rem' }">
  
        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>FAMILIA</th>
            <th>TIPO</th>
            <th>CONDICIÓN</th>
            <th class="text-right">COMISIÓN</th>
            <th>ACCIONES</th>
          </tr>
        </ng-template>
  
        <ng-template pTemplate="body" let-r>
          <tr>
            <td>#{{ r.id }}</td>
  
            <td class="inline-flex align-items-center gap-2">
              <i class="pi pi-box text-yellow-400"></i>
              {{ r.familia }}
            </td>
  
            <td>
              <p-tag [value]="r.tipo" [severity]="r.severity"></p-tag>
            </td>
  
            <td>{{ r.condicion }}</td>
  
            <td class="text-right font-bold text-yellow-400">
              S/ {{ r.comision.toFixed(2) }}
            </td>
  
            <td>
              <div class="flex gap-2">
                <p-button icon="pi pi-pencil" text severity="secondary"></p-button>
                <p-button icon="pi pi-trash" text severity="danger"></p-button>
              </div>
            </td>
          </tr>
        </ng-template>
  
      </p-table>
  
    </p-card>
  
  </div>
  