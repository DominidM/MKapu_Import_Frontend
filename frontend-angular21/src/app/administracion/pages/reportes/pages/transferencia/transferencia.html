<div class="transferencia-page flex flex-column gap-3 w-full px-3 md:px-0 pt-5 md:pt-0">
  <p-card styleClass="transferencia-header-card">
    <div class="transferencia-header-row flex flex-column md:flex-row md:align-items-center md:justify-content-between gap-3">
      <div class="transferencia-header-title flex align-items-center gap-3 w-full md:w-auto">
        <span class="transferencia-title-icon">
          <i class="pi pi-sync"></i>
        </span>
        <div>
          <p class="transferencia-kicker">ADMINISTRADOR - REPORTES - TRANSFERENCIAS</p>
          <h2 class="transferencia-title">GESTION DE TRANSFERENCIAS</h2>
        </div>
      </div>
      <div class="transferencia-header-actions flex w-full md:w-auto md:justify-content-end">
        <p-button
          label="Nueva Transferencia"
          icon="pi pi-plus"
          styleClass="transferencia-pill w-full md:w-auto"
          [routerLink]="['/admin/transferencia/nueva-transferencia']"
        ></p-button>
      </div>
    </div>
  </p-card>

  <div class="transferencia-metrics grid">
    <div class="col-12 md:col-6 xl:col-3">
      <p-card styleClass="metric-card metric-pendiente">
      <div class="metric-header">
        <span class="metric-title">Solicitudes Pendientes</span>
        <span class="metric-icon metric-icon-warning"><i class="pi pi-clock"></i></span>
      </div>
      <div class="metric-value">12</div>
      <div class="metric-sub">+ 2 nuevas hoy</div>
    </p-card>
    </div>

    <div class="col-12 md:col-6 xl:col-3">
      <p-card styleClass="metric-card metric-transito">
      <div class="metric-header">
        <span class="metric-title">En Transito</span>
        <span class="metric-icon metric-icon-info"><i class="pi pi-truck"></i></span>
      </div>
      <div class="metric-value">5</div>
      <div class="metric-sub">En ruta a destino</div>
    </p-card>
    </div>

    <div class="col-12 md:col-6 xl:col-3">
      <p-card styleClass="metric-card metric-recibidos">
      <div class="metric-header">
        <span class="metric-title">Recibidos Hoy</span>
        <span class="metric-icon metric-icon-success"><i class="pi pi-check-circle"></i></span>
      </div>
      <div class="metric-value">28</div>
      <div class="metric-sub">+ 5% vs ayer</div>
    </p-card>
    </div>

    <div class="col-12 md:col-6 xl:col-3">
      <p-card styleClass="metric-card metric-incidencia">
      <div class="metric-header">
        <span class="metric-title">Incidencias</span>
        <span class="metric-icon metric-icon-danger"><i class="pi pi-exclamation-triangle"></i></span>
      </div>
      <div class="metric-value">1</div>
      <div class="metric-sub">Atencion requerida</div>
    </p-card>
    </div>
  </div>

  <p-card styleClass="transferencia-filter-card">
    <div class="transferencia-filter-row flex flex-column md:flex-row md:align-items-end gap-3">
      <div class="transferencia-search-container flex flex-column gap-2 flex-1 w-full">
        <span class="transferencia-search-label">Buscar Transferencia</span>
        <p-autoComplete
          styleClass="transferencia-search-input w-full"
          [(ngModel)]="searchTerm"
          [suggestions]="transferenciaSuggestions"
          field="producto"
          (completeMethod)="onSearch($event)"
          (ngModelChange)="onSearchChange($event)"
          (onSelect)="onSelectTransferencia($event)"
          placeholder="Escribe codigo, producto o sede..."
          style="background: transparent; color: var(--text-color);"
          [inputStyle]="{ width: '100%', background: 'transparent', color: 'var(--text-color)' }"
        >
          <ng-template let-item pTemplate="item">
            <div class="flex flex-column gap-1">
              <span class="font-medium">{{ item.producto }}</span>
              <small class="text-500">{{ item.codigo }}</small>
            </div>
          </ng-template>
        </p-autoComplete>
      </div>
      <div class="transferencia-search-container transferencia-status-filter w-full md:w-14rem">
        <span class="transferencia-search-label">Estado</span>
        <p-select
          styleClass="transferencia-search-input w-full"
          [options]="estadoOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Todos"
          [(ngModel)]="estadoFilter"
          (onChange)="filtrar(searchTerm)"
        ></p-select>
      </div>
      <div class="transferencia-search-container transferencia-status-filter w-full md:w-14rem">
        <span class="transferencia-search-label">Solicitudes</span>
        <p-select
          styleClass="transferencia-search-input w-full"
          [options]="solicitudOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Todas"
          [(ngModel)]="solicitudFilter"
          (onChange)="filtrar(searchTerm)"
        ></p-select>
      </div>
      <div class="transferencia-filter-actions w-full md:w-auto">
        <p-button
          label="Limpiar Filtros"
          icon="pi pi-filter-slash"
          severity="danger"
          styleClass="transferencia-pill transferencia-pill-danger w-full md:w-auto"
          (click)="clearSearch()"
        ></p-button>
      </div>
    </div>
  </p-card>

  <p-toast position="top-right" />

  <p-card>
    <div class="flex flex-column md:flex-row align-items-start md:align-items-center justify-content-between gap-2 mb-3">
      <div class="flex flex-column sm:flex-row align-items-start sm:align-items-center gap-2 w-full md:w-auto">
        <span class="transferencia-section-icon">
          <i class="pi pi-truck"></i>
        </span>
        <span class="text-sm font-semibold text-700">TRANSFERENCIAS REGISTRADAS</span>
        <p-tag
          [value]="'[' + filteredTransferencias.length + '] Transferencias'"
          severity="info"
          styleClass="w-full sm:w-auto"
        ></p-tag>
      </div>
      <p-button icon="pi pi-sliders-h" text severity="secondary" styleClass="transferencia-icon-btn"></p-button>
    </div>

    <div class="transferencia-table-scroll">
      <p-table
        [value]="filteredTransferencias"
        [loading]="loading"
        styleClass="transferencia-table"
        [paginator]="true"
        [rows]="5"
        [rowsPerPageOptions]="[5,10, 20, 50]"
        [tableStyle]="{ 'min-width': '70rem' }"
      >
      <ng-template pTemplate="header">
        <tr>
          <th class="col-codigo">CODIGO</th>
          <th class="col-producto">PRODUCTO</th>
          <th class="col-ruta">RUTA (ORIGEN -> DESTINO)</th>
          <th class="col-cantidad">CANTIDAD</th>
          <th class="col-solicitud">SOLICITUD</th>
          <th class="col-estado">ESTADO</th>
          <th class="col-acciones">ACCIONES</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-transferencia>
        <tr>
          <td>
            <div class="transferencia-code">
              <div class="transferencia-code-main">{{ transferencia.codigo }}</div>
              <div class="transferencia-code-meta">{{ transferencia.fechaEnvio }} Â· {{ transferencia.fechaLlegada }}</div>
            </div>
          </td>
          <td>
            <div class="transferencia-producto">
              <span class="transferencia-producto-nombre">{{ transferencia.producto }}</span>
              <span class="transferencia-producto-meta">Responsable: {{ transferencia.responsable }}</span>
            </div>
          </td>
          <td>
            <div class="transferencia-ruta">
              <span class="transferencia-ruta-sede">{{ transferencia.origen }}</span>
              <i class="pi pi-arrow-right transferencia-ruta-icon"></i>
              <span class="transferencia-ruta-sede transferencia-ruta-destino">{{ transferencia.destino }}</span>
            </div>
          </td>
          <td class="col-cantidad">
            <span class="transferencia-cantidad">{{ transferencia.cantidad }}</span>
          </td>
          <td class="col-solicitud">
            <span class="transferencia-solicitud">{{ transferencia.solicitud }}</span>
          </td>
          <td class="col-estado">
            <p-tag
              [value]="transferencia.estado"
              [severity]="getEstadoSeverity(transferencia.estado)"
              styleClass="transferencia-tag"
            ></p-tag>
          </td>
          <td class="col-acciones">
            <div class="transferencia-actions">
              <p-button
                icon="pi pi-eye"
                text
                severity="secondary"
                styleClass="transferencia-icon-btn transferencia-icon-warn"
                [routerLink]="['/admin/transferencia/detalle-transferencia']"
                [queryParams]="{ codigo: transferencia.codigo }"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="transferencia-empty">
            <div class="transferencia-empty-inner">
              <div class="transferencia-empty-icon">
                <i class="pi pi-inbox"></i>
              </div>
              <div class="transferencia-empty-title">
                {{ hasActiveFilters ? 'No se encontraron transferencias' : 'Aun no hay transferencias' }}
              </div>
              <div class="transferencia-empty-text" *ngIf="hasActiveFilters">
                Ajusta los filtros o prueba con otro termino de busqueda.
              </div>
              <div class="transferencia-empty-actions" *ngIf="hasActiveFilters">
                <p-button
                  label="Limpiar filtros"
                  icon="pi pi-filter-slash"
                  severity="secondary"
                  [outlined]="true"
                  styleClass="transferencia-empty-btn w-full md:w-auto"
                  (click)="clearSearch()"
                ></p-button>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
      </p-table>
    </div>
    <p-confirmdialog />
  </p-card>
</div>
