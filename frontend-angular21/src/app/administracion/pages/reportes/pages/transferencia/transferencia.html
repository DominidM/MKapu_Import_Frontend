<div class="transferencia-page">
  <p-card styleClass="transferencia-header-card">
    <div class="flex align-items-center justify-content-between flex-wrap gap-3">
      <div class="flex align-items-center gap-3">
        <span class="transferencia-title-icon">
          <i class="pi pi-sync"></i>
        </span>
        <div>
          <p class="transferencia-kicker">ADMINISTRADOR - REPORTES - TRANSFERENCIAS</p>
          <h2 class="transferencia-title">GESTION DE TRANSFERENCIAS</h2>
        </div>
      </div>
      <div class="flex justify-items-end gap-2">
        <p-button
          label="Nueva Transferencia"
          icon="pi pi-plus"
          styleClass="transferencia-pill"
          [routerLink]="['/admin/transferencia/nueva-transferencia']"
        ></p-button>
      </div>
    </div>
  </p-card>

  <div class="transferencia-metrics">
    <p-card styleClass="metric-card metric-pendiente">
      <div class="metric-header">
        <span class="metric-title">Solicitudes Pendientes</span>
        <span class="metric-icon metric-icon-warning"><i class="pi pi-clock"></i></span>
      </div>
      <div class="metric-value">12</div>
      <div class="metric-sub">+ 2 nuevas hoy</div>
    </p-card>

    <p-card styleClass="metric-card metric-transito">
      <div class="metric-header">
        <span class="metric-title">En Transito</span>
        <span class="metric-icon metric-icon-info"><i class="pi pi-truck"></i></span>
      </div>
      <div class="metric-value">5</div>
      <div class="metric-sub">En ruta a destino</div>
    </p-card>

    <p-card styleClass="metric-card metric-recibidos">
      <div class="metric-header">
        <span class="metric-title">Recibidos Hoy</span>
        <span class="metric-icon metric-icon-success"><i class="pi pi-check-circle"></i></span>
      </div>
      <div class="metric-value">28</div>
      <div class="metric-sub">+ 5% vs ayer</div>
    </p-card>

    <p-card styleClass="metric-card metric-incidencia">
      <div class="metric-header">
        <span class="metric-title">Incidencias</span>
        <span class="metric-icon metric-icon-danger"><i class="pi pi-exclamation-triangle"></i></span>
      </div>
      <div class="metric-value">1</div>
      <div class="metric-sub">Atencion requerida</div>
    </p-card>
  </div>

  <p-card>
    <div class="flex flex-column lg:flex-row lg:align-items-center lg:justify-content-between gap-3">
      <div class="transferencia-search-container flex-1">
        <span class="transferencia-search-label">Buscar Transferencia</span>
        <p-autoComplete
          class="transferencia-search-input"
          [(ngModel)]="searchTerm"
          [suggestions]="transferenciaSuggestions"
          field="producto"
          (completeMethod)="onSearch($event)"
          (ngModelChange)="onSearchChange($event)"
          (onSelect)="onSelectTransferencia($event)"
          placeholder="Escribe codigo, producto o sede..."
          style="background: transparent; color: var(--text-color);"
          [inputStyle]="{ width: '100%', background: 'transparent', color: 'var(--text-color)' }"
        >
          <ng-template let-item pTemplate="item">
            <div class="flex flex-column gap-1">
              <span class="font-medium">{{ item.producto }}</span>
              <small class="text-500">{{ item.codigo }}</small>
            </div>
          </ng-template>
        </p-autoComplete>
      </div>
      <div class="transferencia-search-container transferencia-status-filter">
        <span class="transferencia-search-label">Estado</span>
        <p-select
          class="transferencia-search-input"
          [options]="estadoOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Todos"
          [(ngModel)]="estadoFilter"
          (onChange)="filtrar(searchTerm)"
        ></p-select>
      </div>
      <div class="flex align-items-center gap-2 transferencia-filter-actions">
        <p-button
          label="Limpiar Filtros"
          icon="pi pi-filter-slash"
          severity="danger"
          styleClass="transferencia-pill transferencia-pill-danger"
          (click)="clearSearch()"
        ></p-button>
      </div>
    </div>
  </p-card>

  <p-toast position="top-right" />

  <p-card>
    <div class="flex align-items-center justify-content-between mb-3">
      <div class="flex align-items-center gap-2">
        <span class="transferencia-section-icon">
          <i class="pi pi-truck"></i>
        </span>
        <span class="text-sm font-semibold text-700">TRANSFERENCIAS REGISTRADAS</span>
        <p-tag [value]="'[' + filteredTransferencias.length + '] Transferencias'" severity="info"></p-tag>
      </div>
      <p-button icon="pi pi-sliders-h" text severity="secondary" styleClass="transferencia-icon-btn"></p-button>
    </div>

    <p-table
      [value]="filteredTransferencias"
      styleClass="transferencia-table"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [tableStyle]="{ 'min-width': '60rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>CODIGO</th>
          <th>PRODUCTO</th>
          <th>RUTA (ORIGEN -> DESTINO)</th>
          <th>CANTIDAD</th>
          <th>ESTADO</th>
          <th>ACCIONES</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-transferencia>
        <tr>
          <td>
            <div class="transferencia-code">
              <div class="transferencia-code-main">{{ transferencia.codigo }}</div>
              <div class="transferencia-code-meta">{{ transferencia.fechaEnvio }} Â· {{ transferencia.fechaLlegada }}</div>
            </div>
          </td>
          <td>
            <div class="transferencia-producto">
              <span class="transferencia-producto-nombre">{{ transferencia.producto }}</span>
              <span class="transferencia-producto-meta">Responsable: {{ transferencia.responsable }}</span>
            </div>
          </td>
          <td>
            <div class="transferencia-ruta">
              <span class="transferencia-ruta-sede">{{ transferencia.origen }}</span>
              <i class="pi pi-arrow-right transferencia-ruta-icon"></i>
              <span class="transferencia-ruta-sede transferencia-ruta-destino">{{ transferencia.destino }}</span>
            </div>
          </td>
          <td>
            <span class="transferencia-cantidad">{{ transferencia.cantidad }}</span>
          </td>
          <td>
            <p-tag
              [value]="transferencia.estado"
              [severity]="getEstadoSeverity(transferencia.estado)"
              styleClass="transferencia-tag"
            ></p-tag>
          </td>
          <td>
            <div class="flex align-items-center gap-2">
              <p-button
                icon="pi pi-eye"
                text
                severity="secondary"
                styleClass="transferencia-icon-btn transferencia-icon-warn"
                [routerLink]="['/admin/transferencia/detalle-transferencia']"
                [queryParams]="{ codigo: transferencia.codigo }"
              ></p-button>
              <p-button
                icon="pi pi-trash"
                text
                severity="danger"
                styleClass="transferencia-icon-btn"
                (click)="confirmDelete(transferencia)"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <p-confirmdialog />
  </p-card>
</div>
